<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Health Assessment - MediCare+</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/boxicons@2.1.4/css/boxicons.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="pdf-generator.js"></script>
    <script src="diet-planner-assessment.js"></script>
    <script src="symptom-checker-assessment.js"></script>
    <script src="../js/comprehensive-symptom-checker-30q.js"></script>
    
    <style>
        :root {
            --primary-50: #eff6ff;
            --primary-100: #dbeafe;
            --primary-200: #bfdbfe;
            --primary-300: #93c5fd;
            --primary-400: #60a5fa;
            --primary-500: #3b82f6;
            --primary-600: #2563eb;
            --primary-700: #1d4ed8;
            --primary-800: #1e40af;
            --primary-900: #1e3a8a;
            
            --success-50: #ecfdf5;
            --success-500: #10b981;
            --success-600: #059669;
            
            --warning-50: #fffbeb;
            --warning-500: #f59e0b;
            --warning-600: #d97706;
            
            --danger-50: #fef2f2;
            --danger-500: #ef4444;
            --danger-600: #dc2626;
            
            --info-50: #f0f9ff;
            --info-500: #06b6d4;
            --info-600: #0891b2;
            
            --gray-50: #f8fafc;
            --gray-100: #f1f5f9;
            --gray-200: #e2e8f0;
            --gray-300: #cbd5e1;
            --gray-400: #94a3b8;
            --gray-500: #64748b;
            --gray-600: #475569;
            --gray-700: #334155;
            --gray-800: #1e293b;
            --gray-900: #0f172a;
            
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-glow: 0 0 20px rgba(59, 130, 246, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: var(--gray-50);
            color: var(--gray-800);
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Hero Section - Minimal spacing */
        .hero-section {
            background: linear-gradient(135deg, #e7f3ff 0%, white 100%);
            min-height: 15vh;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            border-radius: 20px;
            margin: 0.5rem 0;
            padding: 1rem 0;
        }

        .hero-section::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 300px;
            height: 100%;
            background: radial-gradient(circle at center, rgba(0, 123, 255, 0.1) 0%, transparent 70%);
            z-index: 1;
        }

        .back-button {
            position: absolute;
            top: 1.5rem;
            left: 1.5rem;
            background: linear-gradient(135deg, var(--primary-500) 0%, var(--primary-600) 100%);
            border: none;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 2rem;
            font-weight: 600;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
            z-index: 10;
        }

        .back-button:hover {
            background: linear-gradient(135deg, var(--primary-600) 0%, var(--primary-700) 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
            text-decoration: none;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
            margin-top: -1rem;
            position: relative;
            z-index: 2;
            display: flex;
            gap: 2rem;
        }

        .main-content {
            flex: 1;
        }

        .progress-sidebar {
            width: 300px;
            position: sticky;
            top: 2rem;
            height: fit-content;
        }

        .hero-content {
            text-align: center;
            color: var(--gray-800);
            z-index: 2;
            max-width: 800px;
            padding: 1rem;
        }

        /* Progress Sidebar */
        .progress-sidebar {
            background: white;
            border-radius: 1.5rem;
            padding: 1.5rem;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--gray-200);
        }

        .progress-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--gray-800);
            margin-bottom: 1rem;
            text-align: center;
        }

        .current-question-box {
            background: linear-gradient(135deg, var(--primary-500), var(--primary-600));
            border-radius: 1rem;
            padding: 1rem;
            text-align: center;
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.4);
            animation: pulseGlow 2s infinite;
        }

        .current-question-box .question-indicator {
            color: white;
            font-size: 0.9rem;
            font-weight: 600;
        }

        @keyframes pulseGlow {
            0%, 100% { 
                box-shadow: 0 0 20px rgba(59, 130, 246, 0.4);
            }
            50% { 
                box-shadow: 0 0 30px rgba(59, 130, 246, 0.6);
            }
        }

        .progress-summary {
            margin-top: 1rem;
            padding: 0.75rem;
            background: var(--gray-50);
            border-radius: 0.75rem;
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .progress-summary .progress-text {
            font-size: 0.875rem;
            color: var(--gray-600);
        }



        .assessment-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(0, 123, 255, 0.1);
            color: #007BFF;
            padding: 0.75rem 1.5rem;
            border-radius: 2rem;
            font-weight: 600;
            margin-bottom: 2rem;
            border: 1px solid rgba(0, 123, 255, 0.2);
        }

        .assessment-icon {
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            color: white;
            font-size: 1.5rem;
            border: 2px solid rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px);
        }

        .assessment-title {
            font-size: 2rem;
            font-weight: 800;
            color: var(--gray-800);
            margin-bottom: 0.5rem;
        }

        .assessment-subtitle {
            font-size: 1rem;
            color: var(--gray-600);
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.5;
        }

        .stat-label {
            font-size: 0.875rem;
            opacity: 0.9;
        }



        /* Basic Information Form */
        .basic-info-form {
            background: white;
            border-radius: 1.5rem;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--gray-200);
        }

        .form-section-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--gray-800);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .form-label {
            font-weight: 600;
            color: var(--gray-700);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-input, .form-select {
            padding: 0.875rem 1rem;
            border: 1px solid var(--gray-300);
            border-radius: 0.75rem;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--primary-500);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }



        .question-container {
            background: white;
            border: 1px solid var(--gray-200);
            border-radius: 1.5rem;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-lg);
            transition: all 0.3s ease;
        }

        .question-container:hover {
            box-shadow: var(--shadow-glow);
            border-color: var(--primary-300);
        }

        .question-header {
            margin-bottom: 1.5rem;
        }

        .question-number {
            display: inline-flex;
            background: linear-gradient(135deg, var(--primary-500), var(--primary-600));
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            font-weight: 700;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
            margin-right: 1rem;
            flex-shrink: 0;
        }

        .question-header-content {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .question-text-content {
            flex: 1;
        }

        .question-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--gray-800);
            line-height: 1.3;
            margin: 0;
        }

        .question-description {
            color: var(--gray-600);
            margin-bottom: 2rem;
            font-size: 1.125rem;
            line-height: 1.6;
        }

        .answer-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-top: 2rem;
        }

        .answer-options.single-column {
            grid-template-columns: 1fr;
        }

        .answer-option {
            background: white;
            border: 2px solid var(--gray-200);
            border-radius: 1.5rem;
            padding: 0.75rem 1rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .answer-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.05), rgba(147, 197, 253, 0.05));
            opacity: 0;
            transition: opacity 0.3s ease;
            border-radius: 2rem;
        }

        .answer-option:hover {
            border-color: var(--primary-300);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.15);
        }

        .answer-option:hover::before {
            opacity: 1;
        }

        .answer-option.selected {
            border-color: var(--primary-500);
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(147, 197, 253, 0.05));
            box-shadow: 
                0 0 0 1px var(--primary-500),
                0 0 20px rgba(59, 130, 246, 0.3),
                0 8px 25px rgba(59, 130, 246, 0.2);
            transform: translateY(-3px);
        }

        .answer-option.selected::before {
            opacity: 1;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(147, 197, 253, 0.05));
        }

        .option-content {
            position: relative;
            z-index: 2;
        }

        .option-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .option-label {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--gray-800);
            transition: color 0.3s ease;
        }

        .answer-option.selected .option-label {
            color: var(--primary-700);
        }

        .option-indicator {
            width: 24px;
            height: 24px;
            border: 2px solid var(--gray-300);
            border-radius: 50%;
            position: relative;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .answer-option.checkbox .option-indicator {
            border-radius: 8px;
        }

        .answer-option:hover .option-indicator {
            border-color: var(--primary-400);
        }

        .answer-option.selected .option-indicator {
            border-color: var(--primary-500);
            background: var(--primary-500);
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.4);
        }

        .answer-option.selected .option-indicator::after {
            content: '✓';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 14px;
            font-weight: bold;
        }

        .option-description {
            color: var(--gray-600);
            font-size: 0.75rem;
            line-height: 1.4;
            margin: 0;
            transition: color 0.3s ease;
        }

        .answer-option.selected .option-description {
            color: var(--gray-700);
        }

        .text-input-container textarea {
            width: 100%;
            padding: 1.5rem;
            border: 2px solid var(--gray-200);
            border-radius: 1.5rem;
            font-size: 1rem;
            font-family: inherit;
            resize: vertical;
            min-height: 120px;
            transition: all 0.3s ease;
            background: white;
        }

        .text-input-container textarea:focus {
            outline: none;
            border-color: var(--primary-500);
            box-shadow: 
                0 0 0 1px var(--primary-500),
                0 0 20px rgba(59, 130, 246, 0.2);
        }

        .text-input-container textarea::placeholder {
            color: var(--gray-400);
        }



        .progress-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            font-weight: 600;
            color: var(--gray-700);
        }

        .progress-bar {
            height: 12px;
            background: var(--gray-200);
            border-radius: 6px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-500), var(--primary-600));
            border-radius: 6px;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            gap: 1rem;
            margin-top: 3rem;
        }

        .progress-sidebar .navigation-buttons {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            flex-direction: row;
            gap: 0.5rem;
        }

        .progress-sidebar .navigation-buttons .btn {
            flex: 1;
            padding: 0.6rem 0.8rem;
            font-size: 0.85rem;
            justify-content: center;
        }

        .btn {
            padding: 1rem 2.5rem;
            border: none;
            border-radius: 2rem;
            font-weight: 700;
            font-size: 1.125rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            text-decoration: none;
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s ease;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-500), var(--primary-600));
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: linear-gradient(135deg, var(--primary-600), var(--primary-700));
            transform: translateY(-3px);
            box-shadow: 
                var(--shadow-lg),
                0 0 20px rgba(59, 130, 246, 0.4);
        }

        .btn-primary:disabled {
            background: var(--gray-300);
            color: var(--gray-500);
            cursor: not-allowed;
            transform: none;
            box-shadow: var(--shadow-sm);
        }

        .btn-secondary {
            background: white;
            color: var(--gray-700);
            border: 2px solid var(--gray-200);
        }

        .btn-secondary:hover {
            background: var(--gray-50);
            border-color: var(--gray-300);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .results-section {
            display: none;
        }

        .results-section.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .results-header {
            text-align: center;
            margin-bottom: 3rem;
            padding: 3rem;
            background: white;
            border-radius: 2rem;
            border: 1px solid var(--gray-200);
            box-shadow: var(--shadow-lg);
        }

        .results-header h2 {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--gray-800);
            margin-bottom: 1rem;
        }

        .results-header p {
            font-size: 1.25rem;
            color: var(--gray-600);
        }

        .analysis-grid {
            display: grid;
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .analysis-box {
            background: white;
            border: 1px solid var(--gray-200);
            border-radius: 2rem;
            padding: 3rem;
            box-shadow: var(--shadow-lg);
            transition: all 0.3s ease;
        }

        .analysis-box:hover {
            box-shadow: var(--shadow-glow);
            border-color: var(--primary-300);
            transform: translateY(-2px);
        }

        .analysis-box-header {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 2px solid var(--gray-100);
        }

        .analysis-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary-500), var(--primary-600));
            border-radius: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }

        .analysis-title {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--gray-800);
        }

        .analysis-content {
            color: var(--gray-700);
            line-height: 1.8;
            font-size: 1.125rem;
        }

        .pdf-download-section {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border: 1px solid #dee2e6;
            border-radius: 2rem;
            padding: 3rem;
            text-align: center;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-lg);
        }

        .pdf-download-section h3 {
            font-size: 1.75rem;
            font-weight: 800;
            color: var(--gray-800);
            margin-bottom: 1rem;
        }

        .pdf-download-section p {
            font-size: 1.125rem;
            color: var(--gray-600);
            margin-bottom: 2rem;
        }

        .pdf-download-btn {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            color: white;
            padding: 1.25rem 3rem;
            border: none;
            border-radius: 2rem;
            font-weight: 800;
            font-size: 1.25rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 1rem;
            box-shadow: 0 4px 20px rgba(220, 38, 38, 0.4);
        }

        .pdf-download-btn:hover {
            background: linear-gradient(135deg, #b91c1c, #991b1b);
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(220, 38, 38, 0.6), 0 0 20px rgba(220, 38, 38, 0.3);
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.95);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid var(--border-color);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 2rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes slideDown {
            from { opacity: 0; max-height: 0; }
            to { opacity: 1; max-height: 200px; }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @media (max-width: 768px) {
            .hero-section {
                min-height: 40vh;
                padding: 1rem;
            }
            
            .hero-content {
                padding: 1rem;
            }
            
            .assessment-title {
                font-size: 2rem;
            }
            
            .assessment-subtitle {
                font-size: 1rem;
            }
            
            .container {
                padding: 1rem;
                margin-top: -1rem;
                flex-direction: column;
                gap: 1rem;
            }
            
            .progress-sidebar {
                width: 100%;
                position: static;
                order: -1;
                margin-bottom: 1rem;
                padding: 1rem;
            }
            
            .current-question-box {
                padding: 0.75rem;
            }
            
            .back-button {
                position: static;
                margin-bottom: 1rem;
                align-self: flex-start;
            }
            
            .question-container {
                padding: 1.5rem;
            }
            
            .question-header {
                flex-direction: column;
                text-align: center;
                gap: 0.5rem;
            }
            
            .question-icon {
                align-self: center;
            }
            
            .question-title {
                font-size: 1.3rem;
            }
            
            .answer-options {
                grid-template-columns: 1fr !important;
                gap: 1rem;
            }
            
            .answer-option {
                padding: 1rem;
                font-size: 0.9rem;
            }
            
            .navigation-buttons {
                flex-direction: column;
                gap: 1rem;
            }

            .progress-sidebar .navigation-buttons {
                flex-direction: column;
                gap: 0.75rem;
            }
            
            .btn {
                justify-content: center;
                padding: 1rem 2rem;
            }
            
            .analysis-box {
                padding: 1.5rem;
            }
            
            .results-header {
                padding: 1.5rem;
            }
            
            .results-header h2 {
                font-size: 1.75rem;
            }
        }

        @media (max-width: 480px) {
            .assessment-title {
                font-size: 2rem;
            }
            
            .question-container {
                padding: 1.5rem;
            }
            
            .analysis-box {
                padding: 1.5rem;
            }
        }

        /* Assessment Type Specific Styling */
        .assessment-type-symptom .assessment-icon { background: linear-gradient(135deg, #ef4444, #dc2626); }
        .assessment-type-diet .assessment-icon { background: linear-gradient(135deg, #10b981, #059669); }
        .assessment-type-mental .assessment-icon { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }
    </style>
</head>

<body>
    <!-- Hero Section -->
    <section class="hero-section">
        <a href="ai-health-assistant.html" class="back-button">
            <i class="fas fa-arrow-left"></i>
            Back
        </a>

        <div class="hero-content">
            <div class="assessment-badge">
                <i class="fas fa-robot"></i>
                AI-Powered Assessment
            </div>
            <h1 class="assessment-title" id="assessmentTitle">AI Health Assessment</h1>
            <p class="assessment-subtitle" id="assessmentSubtitle">
                Complete this comprehensive health assessment to receive personalized insights, detailed analysis, and professional recommendations with downloadable PDF reports.
            </p>

        </div>
    </section>

    <div class="loading-overlay" id="loadingOverlay">
        <div>
            <div class="spinner"></div>
            <h3>Analyzing Your Responses</h3>
            <p>Our AI is processing your information...</p>
        </div>
    </div>

    <div class="container">
        <!-- Progress Sidebar -->
        <div class="progress-sidebar" id="progressSidebar">
            <div class="progress-title">Progress</div>
            <div class="current-question-box" id="currentQuestionBox">
                <div class="question-indicator" id="questionIndicator">Question 1</div>
            </div>
            <div class="progress-summary">
                <div class="progress-text" id="progressText">Question 1 of 30</div>
            </div>

            <!-- Navigation buttons under progress bar -->
            <div class="navigation-buttons" style="margin-top: 1rem;">
                <button class="btn btn-secondary" id="prevBtn" onclick="previousQuestion()" style="display: none;">
                    <i class="fas fa-arrow-left"></i>
                    Previous
                </button>
                <button class="btn btn-primary" id="nextBtn" onclick="nextQuestion()" disabled>
                    Next
                    <i class="fas fa-arrow-right"></i>
                </button>
            </div>

        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="assessment-section" id="assessmentSection">
                <div class="question-container" id="questionContainer">
                    <!-- Questions loaded dynamically -->
                </div>



            <!-- Small disclaimer -->
            <div class="ai-policy-note" style="margin-top: 1rem; padding: 1rem; background: rgba(0, 102, 255, 0.05); border: 1px solid rgba(0, 102, 255, 0.2); border-radius: 0.5rem; text-align: center;">
                <p style="color: var(--text-dark); font-size: 0.85rem; margin: 0; line-height: 1.4;">
                    By proceeding with this assessment, you acknowledge that you have read, understood, and agree to our 
                    <a href="ai-assistant-policy.html" style="color: var(--primary-color); text-decoration: none; font-weight: 600;">AI Usage Policy</a>, 
                    <a href="privacy-policy.html" style="color: var(--primary-color); text-decoration: none; font-weight: 600;">Privacy Policy</a>, and 
                    <a href="terms-of-use.html" style="color: var(--primary-color); text-decoration: none; font-weight: 600;">Terms of Use</a>.
                </p>
            </div>
            </div>

            <div class="results-section" id="resultsSection">
            <div class="results-header">
                <h2>Your Personalized Health Analysis</h2>
                <p>Based on your responses, here's your comprehensive assessment</p>
            </div>

            <div class="analysis-grid" id="analysisGrid">
                <!-- Analysis boxes loaded dynamically -->
            </div>

            <div class="pdf-download-section">
                <h3 style="margin-bottom: 1rem;">Download Your Report</h3>
                <p style="margin-bottom: 2rem; color: var(--text-light);">
                    Get a comprehensive PDF report with all your results
                </p>
                <button class="pdf-download-btn" onclick="downloadPDF()">
                    <i class="fas fa-download"></i>
                    Download PDF Report
                </button>
            </div>

            <!-- Post-Assessment Disclaimer -->
            <div class="post-assessment-disclaimer" style="margin: 2rem 0; padding: 1.5rem; background: linear-gradient(135deg, rgba(0, 102, 255, 0.05) 0%, rgba(255, 255, 255, 1) 100%); border: 2px solid rgba(0, 102, 255, 0.2); border-radius: 1rem; text-align: center; box-shadow: 0 4px 15px rgba(0, 102, 255, 0.1);">
                <div style="display: flex; align-items: center; justify-content: center; margin-bottom: 0.75rem;">
                    <i class="fas fa-shield-alt" style="font-size: 1.5rem; color: var(--primary-color); margin-right: 0.75rem;"></i>
                    <h4 style="color: var(--primary-color); font-weight: 600; margin: 0;">Important Notice</h4>
                </div>
                <p style="color: var(--text-dark); font-size: 0.9rem; margin: 0; line-height: 1.6;">
                    By completing this AI assessment, you agree to our 
                    <a href="ai-assistant-policy.html" style="color: var(--primary-color); text-decoration: none; font-weight: 600; border-bottom: 1px solid var(--primary-color);">AI Usage Policy</a>
                    and understand that this tool provides general health information and should not replace professional medical advice.
                </p>
            </div>

            <div class="navigation-buttons">
                <button class="btn btn-secondary" onclick="startNewAssessment()">
                    <i class="fas fa-redo"></i>
                    New Assessment
                </button>
                <a href="user-dashboard.html" class="btn btn-primary">
                    <i class="fas fa-home"></i>
                    Back to Dashboard
                </a>
            </div>
        </div>
    </div>

    <script src="config.js"></script>
    <script src="../js/assessment-configs.js"></script>
    <script>
        // Enhanced AI Health Assessment System
        class EnhancedAIHealthSystem {
            constructor() {
                this.currentQuestion = 0;
                this.responses = {};
                this.assessmentType = this.getAssessmentType();
                this.questions = this.getQuestionsForType(this.assessmentType);
                this.analysisResults = null;
                this.init();
            }

            init() {
                console.log(`🧠 Loading ${this.assessmentType} assessment with ${this.questions.length} questions`);
                this.updateAssessmentHeader();
                this.loadQuestion();
                this.updateProgress();
                this.updateNavigationButtons();
            }

            getAssessmentType() {
                const urlParams = new URLSearchParams(window.location.search);
                return urlParams.get('type') || 'symptom-checker';
            }

            getQuestionsForType(type) {
                // Use the comprehensive 30-question configuration from assessment-configs.js
                if (window.ASSESSMENT_CONFIGS && window.ASSESSMENT_CONFIGS[type]) {
                    const config = window.ASSESSMENT_CONFIGS[type];
                    console.log(`✅ Loaded ${config.questions.length} questions for ${type}`);
                    return config.questions;
                }
                
                console.warn(`⚠️ Assessment config not found for ${type}, using comprehensive fallback`);
                
                // Basic questions that apply to all assessments (5 questions)
                const basicQuestions = [
                    { id: 1, type: 'text', question: 'Q1. What is your full name?', description: 'Please enter your complete name.', required: true, placeholder: 'Enter your full name' },
                    { id: 2, type: 'text', question: 'Q2. What is your age?', description: 'Please enter your age in years.', required: true, placeholder: 'Enter your age (e.g., 25)' },
                    { id: 3, type: 'multiple', question: 'Q3. What is your gender?', description: 'Please select your gender.', options: [{ value: 'male', label: 'Male' }, { value: 'female', label: 'Female' }, { value: 'other', label: 'Other' }], required: true },
                    { id: 4, type: 'multiple', question: 'Q4. Which district are you from?', description: 'Select your district in Sri Lanka.', 
                      options: [
                        { value: 'colombo', label: 'Colombo' }, { value: 'gampaha', label: 'Gampaha' }, { value: 'kalutara', label: 'Kalutara' },
                        { value: 'kandy', label: 'Kandy' }, { value: 'matale', label: 'Matale' }, { value: 'nuwara-eliya', label: 'Nuwara Eliya' },
                        { value: 'galle', label: 'Galle' }, { value: 'matara', label: 'Matara' }, { value: 'hambantota', label: 'Hambantota' },
                        { value: 'jaffna', label: 'Jaffna' }, { value: 'kilinochchi', label: 'Kilinochchi' }, { value: 'mannar', label: 'Mannar' },
                        { value: 'vavuniya', label: 'Vavuniya' }, { value: 'mullaitivu', label: 'Mullaitivu' }, { value: 'batticaloa', label: 'Batticaloa' },
                        { value: 'ampara', label: 'Ampara' }, { value: 'trincomalee', label: 'Trincomalee' }, { value: 'kurunegala', label: 'Kurunegala' },
                        { value: 'puttalam', label: 'Puttalam' }, { value: 'anuradhapura', label: 'Anuradhapura' }, { value: 'polonnaruwa', label: 'Polonnaruwa' },
                        { value: 'badulla', label: 'Badulla' }, { value: 'monaragala', label: 'Monaragala' }, { value: 'ratnapura', label: 'Ratnapura' }, { value: 'kegalle', label: 'Kegalle' }
                      ], required: true },
                    { id: 5, type: 'text', question: 'Q5. What is your contact number?', description: 'Please enter your phone number.', required: true, placeholder: 'Enter your contact number (e.g., 0771234567)' }
                ];
                
                // Specialized questions for each assessment type (20-25 questions)
                const specializedQuestions = this.getSpecializedQuestions(type);
                
                // Combine basic + specialized questions (total 25-30 questions)
                return [...basicQuestions, ...specializedQuestions];
            }
            
            getSpecializedQuestions(type) {
                const questionSets = {
                    'symptom-checker': [
                        { id: 6, type: 'multiple', question: 'Q6. What is your primary symptom?', description: 'Select your main health concern', options: [
                            { value: 'headache', label: 'Headache' }, { value: 'chest-pain', label: 'Chest pain' }, { value: 'abdominal-pain', label: 'Abdominal pain' },
                            { value: 'back-pain', label: 'Back pain' }, { value: 'joint-pain', label: 'Joint pain' }, { value: 'breathing-issues', label: 'Breathing issues' },
                            { value: 'fatigue', label: 'Fatigue' }, { value: 'skin-problems', label: 'Skin problems' }, { value: 'digestive-issues', label: 'Digestive issues' }, { value: 'other', label: 'Other' }
                        ], required: true },
                        { id: 7, type: 'multiple', question: 'Q7. Rate your pain level (1-10)', description: 'Scale from 1 (mild) to 10 (severe)', options: [
                            { value: '1', label: '1 - Very Mild' }, { value: '2', label: '2 - Mild' }, { value: '3', label: '3 - Mild to Moderate' },
                            { value: '4', label: '4 - Moderate' }, { value: '5', label: '5 - Moderate' }, { value: '6', label: '6 - Moderate to Severe' },
                            { value: '7', label: '7 - Severe' }, { value: '8', label: '8 - Very Severe' }, { value: '9', label: '9 - Extremely Severe' }, { value: '10', label: '10 - Worst Possible' }
                        ], required: true },
                        { id: 8, type: 'multiple', question: 'Q8. When did symptoms start?', description: 'Timeline of symptom onset', options: [
                            { value: 'less-1-hour', label: 'Less than 1 hour' }, { value: '1-6-hours', label: '1-6 hours' }, { value: '6-24-hours', label: '6-24 hours' },
                            { value: '1-3-days', label: '1-3 days' }, { value: '4-7-days', label: '4-7 days' }, { value: '1-2-weeks', label: '1-2 weeks' }, { value: 'more-2-weeks', label: 'More than 2 weeks' }
                        ], required: true },
                        { id: 9, type: 'multiple', question: 'Q9. Emergency symptoms present?', description: 'Select any emergency symptoms you have', multiple: true, options: [
                            { value: 'fever-chills', label: 'Fever/chills' }, { value: 'nausea-vomiting', label: 'Nausea/vomiting' }, { value: 'dizziness', label: 'Dizziness' },
                            { value: 'shortness-breath', label: 'Shortness of breath' }, { value: 'rapid-heartbeat', label: 'Rapid heartbeat' }, { value: 'sweating', label: 'Sweating' },
                            { value: 'confusion', label: 'Confusion' }, { value: 'severe-weakness', label: 'Severe weakness' }, { value: 'none', label: 'None' }
                        ], required: true },
                        { id: 10, type: 'multiple', question: 'Q10. Describe your pain type', description: 'What does the pain feel like?', options: [
                            { value: 'sharp-stabbing', label: 'Sharp/stabbing' }, { value: 'dull-aching', label: 'Dull/aching' }, { value: 'burning', label: 'Burning' },
                            { value: 'cramping', label: 'Cramping' }, { value: 'throbbing', label: 'Throbbing' }, { value: 'pressure-like', label: 'Pressure-like' },
                            { value: 'electric-shock', label: 'Electric shock' }, { value: 'no-pain', label: 'No pain' }
                        ], required: true },
                        { id: 11, type: 'multiple', question: 'Q11. What makes symptoms better?', description: 'Select what provides relief', multiple: true, options: [
                            { value: 'rest', label: 'Rest' }, { value: 'movement', label: 'Movement' }, { value: 'heat', label: 'Heat' }, { value: 'cold', label: 'Cold' },
                            { value: 'otc-medications', label: 'OTC medications' }, { value: 'prescription-meds', label: 'Prescription meds' },
                            { value: 'food-water', label: 'Food/water' }, { value: 'nothing-helps', label: 'Nothing helps' }
                        ], required: true },
                        { id: 12, type: 'multiple', question: 'Q12. What makes symptoms worse?', description: 'Select what worsens your symptoms', multiple: true, options: [
                            { value: 'physical-activity', label: 'Physical activity' }, { value: 'certain-positions', label: 'Certain positions' }, { value: 'eating-drinking', label: 'Eating/drinking' },
                            { value: 'stress', label: 'Stress' }, { value: 'weather-changes', label: 'Weather changes' }, { value: 'touch-pressure', label: 'Touch/pressure' },
                            { value: 'deep-breathing', label: 'Deep breathing' }, { value: 'nothing', label: 'Nothing' }
                        ], required: true },
                        { id: 13, type: 'text', question: 'Q13. Current temperature (°F)', description: 'Enter your body temperature if measured', required: false, placeholder: 'e.g., 98.6' },
                        { id: 14, type: 'multiple', question: 'Q14. Neurological symptoms?', description: 'Any nervous system symptoms', multiple: true, options: [
                            { value: 'memory-problems', label: 'Memory problems' }, { value: 'confusion', label: 'Confusion' }, { value: 'difficulty-concentrating', label: 'Difficulty concentrating' },
                            { value: 'seizures', label: 'Seizures' }, { value: 'tremors', label: 'Tremors' }, { value: 'muscle-weakness', label: 'Muscle weakness' },
                            { value: 'coordination-issues', label: 'Coordination issues' }, { value: 'speech-problems', label: 'Speech problems' },
                            { value: 'vision-changes', label: 'Vision changes' }, { value: 'none', label: 'None' }
                        ], required: true },
                        { id: 15, type: 'multiple', question: 'Q15. Recent travel history', description: 'Any recent travel', options: [
                            { value: 'no-travel', label: 'No travel' }, { value: 'domestic-travel', label: 'Domestic travel' }, { value: 'international-travel', label: 'International travel' },
                            { value: 'high-risk-area', label: 'High-risk area travel' }, { value: 'sick-contact-travel', label: 'Sick contact during travel' }
                        ], required: true },
                        { id: 16, type: 'multiple', question: 'Q16. Known allergies', description: 'Select your known allergies', multiple: true, options: [
                            { value: 'food-allergies', label: 'Food allergies' }, { value: 'drug-allergies', label: 'Drug allergies' }, { value: 'environmental-allergies', label: 'Environmental allergies' },
                            { value: 'latex-allergy', label: 'Latex allergy' }, { value: 'animal-allergies', label: 'Animal allergies' }, { value: 'insect-allergies', label: 'Insect allergies' }, { value: 'no-allergies', label: 'No allergies' }
                        ], required: true },
                        { id: 17, type: 'multiple', question: 'Q17. Current medications', description: 'Select medications you are taking', multiple: true, options: [
                            { value: 'blood-pressure-meds', label: 'Blood pressure meds' }, { value: 'diabetes-meds', label: 'Diabetes meds' }, { value: 'heart-medications', label: 'Heart medications' },
                            { value: 'blood-thinners', label: 'Blood thinners' }, { value: 'pain-medications', label: 'Pain medications' }, { value: 'antibiotics', label: 'Antibiotics' },
                            { value: 'vitamins', label: 'Vitamins' }, { value: 'birth-control', label: 'Birth control' }, { value: 'antidepressants', label: 'Antidepressants' }, { value: 'none', label: 'None' }
                        ], required: true },
                        { id: 18, type: 'multiple', question: 'Q18. Recent injuries', description: 'Any recent injuries or trauma', options: [
                            { value: 'no-injuries', label: 'No injuries' }, { value: 'head-injury', label: 'Head injury' }, { value: 'fall-trauma', label: 'Fall/trauma' },
                            { value: 'sports-injury', label: 'Sports injury' }, { value: 'car-accident', label: 'Car accident' }, { value: 'work-injury', label: 'Work injury' }, { value: 'cut-wound', label: 'Cut/wound' }
                        ], required: true },
                        { id: 19, type: 'multiple', question: 'Q19. Appetite changes', description: 'Changes in your eating patterns', options: [
                            { value: 'normal-appetite', label: 'Normal appetite' }, { value: 'increased-appetite', label: 'Increased appetite' }, { value: 'decreased-appetite', label: 'Decreased appetite' },
                            { value: 'no-appetite', label: 'No appetite' }, { value: 'nausea-eating', label: 'Nausea when eating' }, { value: 'difficulty-swallowing', label: 'Difficulty swallowing' }
                        ], required: true },
                        { id: 20, type: 'multiple', question: 'Q20. Sleep quality', description: 'How has your sleep been?', options: [
                            { value: 'normal-sleep', label: 'Normal sleep' }, { value: 'trouble-falling-asleep', label: 'Trouble falling asleep' }, { value: 'frequent-waking', label: 'Frequent waking' },
                            { value: 'early-waking', label: 'Early waking' }, { value: 'sleeping-more', label: 'Sleeping more' }, { value: 'pain-disrupts-sleep', label: 'Pain disrupts sleep' }, { value: 'cant-sleep', label: 'Can\'t sleep' }
                        ], required: true },
                        { id: 21, type: 'multiple', question: 'Q21. Chronic conditions', description: 'Select any chronic health conditions', multiple: true, options: [
                            { value: 'diabetes', label: 'Diabetes' }, { value: 'high-blood-pressure', label: 'High blood pressure' }, { value: 'heart-disease', label: 'Heart disease' },
                            { value: 'asthma', label: 'Asthma' }, { value: 'arthritis', label: 'Arthritis' }, { value: 'cancer', label: 'Cancer' },
                            { value: 'kidney-disease', label: 'Kidney disease' }, { value: 'liver-disease', label: 'Liver disease' }, { value: 'mental-health', label: 'Mental health' }, { value: 'none', label: 'None' }
                        ], required: true },
                        { id: 22, type: 'multiple', question: 'Q22. Stress level (1-10)', description: 'Rate your current stress level', options: [
                            { value: '1', label: '1 - No stress' }, { value: '2', label: '2 - Very low' }, { value: '3', label: '3 - Low' },
                            { value: '4', label: '4 - Mild' }, { value: '5', label: '5 - Moderate' }, { value: '6', label: '6 - Moderate-high' },
                            { value: '7', label: '7 - High' }, { value: '8', label: '8 - Very high' }, { value: '9', label: '9 - Extreme' }, { value: '10', label: '10 - Overwhelming' }
                        ], required: true },
                        { id: 23, type: 'multiple', question: 'Q23. Recent illness exposure', description: 'Exposure to sick people recently', options: [
                            { value: 'no-exposure', label: 'No exposure' }, { value: 'family-member-sick', label: 'Family member sick' }, { value: 'coworker-sick', label: 'Coworker sick' },
                            { value: 'healthcare-exposure', label: 'Healthcare exposure' }, { value: 'public-gathering', label: 'Public gathering' }, { value: 'school-daycare-exposure', label: 'School/daycare exposure' }
                        ], required: true },
                        { id: 24, type: 'multiple', question: 'Q24. Energy level (1-10)', description: 'Rate your current energy level', options: [
                            { value: '1', label: '1 - No energy' }, { value: '2', label: '2 - Very low' }, { value: '3', label: '3 - Low' },
                            { value: '4', label: '4 - Below average' }, { value: '5', label: '5 - Average' }, { value: '6', label: '6 - Above average' },
                            { value: '7', label: '7 - Good' }, { value: '8', label: '8 - Very good' }, { value: '9', label: '9 - High' }, { value: '10', label: '10 - Excellent' }
                        ], required: true },
                        { id: 25, type: 'multiple', question: 'Q25. Bowel movement changes', description: 'Any changes in bowel habits', options: [
                            { value: 'normal', label: 'Normal' }, { value: 'constipation', label: 'Constipation' }, { value: 'diarrhea', label: 'Diarrhea' },
                            { value: 'blood-in-stool', label: 'Blood in stool' }, { value: 'black-stool', label: 'Black stool' }, { value: 'severe-cramping', label: 'Severe cramping' },
                            { value: 'no-bowel-movement-3-days', label: 'No bowel movement 3+ days' }
                        ], required: true },
                        { id: 26, type: 'multiple', question: 'Q26. Urination changes', description: 'Any changes in urination', options: [
                            { value: 'normal', label: 'Normal' }, { value: 'frequent-urination', label: 'Frequent urination' }, { value: 'painful-urination', label: 'Painful urination' },
                            { value: 'blood-in-urine', label: 'Blood in urine' }, { value: 'difficulty-urinating', label: 'Difficulty urinating' }, { value: 'unable-to-urinate', label: 'Unable to urinate' },
                            { value: 'unusual-odor-color', label: 'Unusual odor/color' }
                        ], required: true },
                        { id: 27, type: 'multiple', question: 'Q27. Breathing description', description: 'How is your breathing?', options: [
                            { value: 'normal', label: 'Normal' }, { value: 'slightly-short', label: 'Slightly short' }, { value: 'moderately-short', label: 'Moderately short' },
                            { value: 'severely-short', label: 'Severely short' }, { value: 'cant-catch-breath', label: 'Can\'t catch breath' }, { value: 'wheezing', label: 'Wheezing' },
                            { value: 'cough-with-breathing', label: 'Cough with breathing' }
                        ], required: true },
                        { id: 28, type: 'multiple', question: 'Q28. Skin changes', description: 'Any changes to your skin', multiple: true, options: [
                            { value: 'no-changes', label: 'No changes' }, { value: 'rash-redness', label: 'Rash/redness' }, { value: 'itching', label: 'Itching' },
                            { value: 'swelling', label: 'Swelling' }, { value: 'bruising', label: 'Bruising' }, { value: 'cuts-wounds', label: 'Cuts/wounds' },
                            { value: 'color-changes', label: 'Color changes' }, { value: 'new-moles', label: 'New moles' }
                        ], required: true },
                        { id: 29, type: 'multiple', question: 'Q29. Anxiety about symptoms (1-10)', description: 'How anxious are you about your symptoms?', options: [
                            { value: '1', label: '1 - Not anxious' }, { value: '2', label: '2 - Very low' }, { value: '3', label: '3 - Low' },
                            { value: '4', label: '4 - Mild' }, { value: '5', label: '5 - Moderate' }, { value: '6', label: '6 - Moderate-high' },
                            { value: '7', label: '7 - High' }, { value: '8', label: '8 - Very high' }, { value: '9', label: '9 - Severe' }, { value: '10', label: '10 - Panic' }
                        ], required: true },
                        { id: 30, type: 'text', question: 'Q30. Additional concerns', description: 'Any other symptoms or concerns you want to mention?', required: false, placeholder: 'Describe any other symptoms or concerns...' }
                    ],
                    
                    'mental-health': [
                        { id: 6, type: 'multiple', question: 'Q6. Overall mood today?', description: 'Rate your mood on a scale of 1-10', options: [
                            { value: '1', label: '1 - Very Poor' }, { value: '2', label: '2 - Poor' }, { value: '3', label: '3 - Below Average' },
                            { value: '4', label: '4 - Somewhat Low' }, { value: '5', label: '5 - Average' }, { value: '6', label: '6 - Somewhat Good' },
                            { value: '7', label: '7 - Good' }, { value: '8', label: '8 - Very Good' }, { value: '9', label: '9 - Excellent' }, { value: '10', label: '10 - Outstanding' }
                        ], required: true },
                        { id: 7, type: 'multiple', question: 'Q7. Mental health concerns?', description: 'Select all that apply to your current situation', multiple: true, options: [
                            { value: 'anxiety', label: 'Anxiety' }, { value: 'depression', label: 'Depression' }, { value: 'stress', label: 'Stress' },
                            { value: 'sleep-issues', label: 'Sleep problems' }, { value: 'mood-swings', label: 'Mood swings' }, { value: 'panic-attacks', label: 'Panic attacks' }
                        ], required: true },
                        { id: 8, type: 'text', question: 'Q8. Duration of symptoms?', description: 'How long have you been experiencing these feelings?', required: true, placeholder: 'e.g., 2 weeks, 3 months, 1 year' },
                        { id: 9, type: 'multiple', question: 'Q9. Impact on daily life?', description: 'How much do these feelings interfere with your daily activities?', options: [
                            { value: 'minimal', label: 'Minimal interference' }, { value: 'mild', label: 'Mild interference' },
                            { value: 'moderate', label: 'Moderate interference' }, { value: 'severe', label: 'Severe interference' }, { value: 'extreme', label: 'Unable to function normally' }
                        ], required: true }
                        // Add more mental health questions here...
                    ],
                    
                    'diet-planner': [
                        { id: 6, type: 'multiple', question: 'Q6. Dietary goals?', description: 'What are your main dietary objectives?', multiple: true, options: [
                            { value: 'weight-loss', label: 'Weight loss' }, { value: 'weight-gain', label: 'Weight gain' }, { value: 'muscle-building', label: 'Muscle building' },
                            { value: 'health', label: 'Better overall health' }, { value: 'medical', label: 'Medical condition management' }, { value: 'performance', label: 'Athletic performance' }
                        ], required: true },
                        { id: 7, type: 'text', question: 'Q7. Current weight?', description: 'What is your current weight in kilograms?', required: true, placeholder: 'Enter weight in kg (e.g., 65)' },
                        { id: 8, type: 'text', question: 'Q8. Height?', description: 'What is your height in centimeters?', required: true, placeholder: 'Enter height in cm (e.g., 170)' },
                        { id: 9, type: 'multiple', question: 'Q9. Activity level?', description: 'How would you describe your physical activity level?', options: [
                            { value: 'sedentary', label: 'Sedentary (little to no exercise)' }, { value: 'light', label: 'Lightly active (light exercise 1-3 days/week)' },
                            { value: 'moderate', label: 'Moderately active (moderate exercise 3-5 days/week)' }, { value: 'very', label: 'Very active (hard exercise 6-7 days/week)' },
                            { value: 'extreme', label: 'Extremely active (very hard exercise, physical job)' }
                        ], required: true }
                        // Add more diet planner questions here...
                    ]
                    
                    // Add more assessment types as needed...
                };
                
                // Default questions for assessments not specifically configured
                const defaultQuestions = [
                    { id: 6, type: 'text', question: 'Q6. What is your primary concern?', description: 'Please describe your main health concern or goal.', required: true, placeholder: 'Describe your primary concern' },
                    { id: 7, type: 'text', question: 'Q7. How long have you had this concern?', description: 'When did this issue start or how long have you been thinking about it?', required: false, placeholder: 'e.g., 1 week, 6 months, always' },
                    { id: 8, type: 'multiple', question: 'Q8. How important is addressing this?', description: 'Rate the importance of getting help with this issue', options: [
                        { value: 'low', label: 'Low priority' }, { value: 'medium', label: 'Medium priority' }, { value: 'high', label: 'High priority' }, { value: 'urgent', label: 'Urgent' }
                    ], required: true },
                    { id: 9, type: 'text', question: 'Q9. Additional information', description: 'Any other details you think are important?', required: false, placeholder: 'Share any additional concerns or information' }
                ];
                
                return questionSets[type] || defaultQuestions;
            }

            updateAssessmentHeader() {
                const config = this.getAssessmentConfig(this.assessmentType);
                const titleElement = document.getElementById('assessmentTitle');
                const subtitleElement = document.getElementById('assessmentSubtitle');
                
                if (titleElement) titleElement.textContent = config.title;
                if (subtitleElement) subtitleElement.textContent = config.subtitle;
            }

            getAssessmentConfig(type) {
                // Use configuration from assessment-configs.js if available
                if (window.ASSESSMENT_CONFIGS && window.ASSESSMENT_CONFIGS[type]) {
                    return window.ASSESSMENT_CONFIGS[type];
                }
                
                // Fallback configurations for all 12 assessment types
                const fallbackConfigs = {
                    'symptom-checker': { title: 'AI Symptom Checker', subtitle: 'Advanced symptom analysis with AI-powered medical guidance', icon: 'fas fa-stethoscope' },
                    'diet-planner': { title: 'Smart Diet Planner', subtitle: 'Personalized nutrition plans and meal recommendations', icon: 'fas fa-utensils' },
                    'mental-health': { title: 'Mental Health Support', subtitle: 'Comprehensive mental wellness assessment and support', icon: 'fas fa-brain' },
                    'fitness-coach': { title: 'AI Fitness Coach', subtitle: 'Personalized workout plans and expert fitness guidance', icon: 'fas fa-dumbbell' },
                    'sleep-analyzer': { title: 'Sleep Quality Analyzer', subtitle: 'Comprehensive sleep analysis with personalized recommendations', icon: 'fas fa-bed' },
                    'medicine-advisor': { title: 'Medicine Advisor', subtitle: 'Expert guidance about medications and drug interactions', icon: 'fas fa-pills' },
                    'chronic-disease': { title: 'Chronic Disease Management', subtitle: 'Specialized care for diabetes, hypertension, and chronic conditions', icon: 'fas fa-heartbeat' },
                    'womens-health': { title: 'Women\'s Health Specialist', subtitle: 'Comprehensive reproductive and hormonal health guidance', icon: 'fas fa-venus' },
                    'pediatric-health': { title: 'Pediatric Health Care', subtitle: 'Specialized health assessment for children and adolescents', icon: 'fas fa-child' },
                    'senior-health': { title: 'Senior Health Care', subtitle: 'Age-specific health management for older adults', icon: 'fas fa-user-friends' },
                    'preventive-screening': { title: 'Preventive Health Screening', subtitle: 'Early detection and prevention strategies', icon: 'fas fa-shield-alt' },
                    'addiction-recovery': { title: 'Addiction Recovery Support', subtitle: 'Evidence-based addiction treatment and recovery guidance', icon: 'fas fa-hands-helping' }
                };
                return fallbackConfigs[type] || fallbackConfigs['symptom-checker'];
            }

            loadQuestion() {
                const question = this.questions[this.currentQuestion];
                if (!question) return;
                
                const container = document.getElementById('questionContainer');
                if (!container) return;
                
                // Remove the Q1, Q2 format from question text
                const cleanQuestionText = question.question.replace(/^Q\d+\.\s*/, '');
                
                container.innerHTML = `
                    <div class="question-header">
                        <div class="question-header-content">
                            <div class="question-number">${this.currentQuestion + 1}</div>
                            <div class="question-text-content">
                                <h2 class="question-title">${cleanQuestionText}</h2>
                                <p class="question-description">${question.description}</p>
                            </div>
                        </div>
                    </div>
                    <div class="question-content">${this.renderQuestionInput(question)}</div>
                `;
                
                // Restore previous response if exists
                if (this.responses[this.currentQuestion + 1]) {
                    if (question.type === 'text') {
                        const textInput = document.getElementById('textInput');
                        if (textInput) textInput.value = this.responses[this.currentQuestion + 1];
                    } else {
                        this.updateOptionDisplay();
                    }
                }
            }

            renderQuestionInput(question) {
                if (question.type === 'text') {
                    return `
                        <div class="text-input-container">
                            <textarea 
                                id="textInput" 
                                placeholder="${question.placeholder || 'Enter your response...'}" 
                                rows="4" 
                                oninput="window.assessment.handleTextInput(this.value)"
                            ></textarea>
                        </div>
                    `;
                } else if (question.type === 'multiple') {
                    const optionsClass = question.options.length > 4 ? 'single-column' : '';
                    return `
                        <div class="answer-options ${optionsClass}">
                            ${question.options.map(option => `
                                <div class="answer-option ${question.multiple ? 'checkbox' : 'radio'}" 
                                     onclick="window.assessment.selectOption('${option.value}', ${question.multiple || false})" 
                                     data-value="${option.value}">
                                    <div class="option-content">
                                        <div class="option-header">
                                            <span class="option-label">${option.label}</span>
                                            <div class="option-indicator"></div>
                                        </div>
                                        ${option.description ? `<p class="option-description">${option.description}</p>` : ''}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                }
            }

            selectOption(value, isMultiple = false) {
                if (isMultiple) {
                    if (!this.responses[this.currentQuestion + 1]) {
                        this.responses[this.currentQuestion + 1] = [];
                    }
                    const responses = this.responses[this.currentQuestion + 1];
                    const index = responses.indexOf(value);
                    if (index > -1) {
                        responses.splice(index, 1);
                    } else {
                        responses.push(value);
                    }
                } else {
                    this.responses[this.currentQuestion + 1] = value;
                }
                
                this.updateOptionDisplay();
                this.updateNavigationButtons();
            }

            handleTextInput(value) {
                this.responses[this.currentQuestion + 1] = value;
                this.updateNavigationButtons();
            }

            updateOptionDisplay() {
                const options = document.querySelectorAll('.answer-option');
                const currentResponse = this.responses[this.currentQuestion + 1];
                
                options.forEach(option => {
                    const value = option.dataset.value;
                    const isSelected = Array.isArray(currentResponse) 
                        ? currentResponse.includes(value) 
                        : currentResponse === value;
                    
                    option.classList.toggle('selected', isSelected);
                });
            }

            updateProgress() {
                // Update sidebar progress
                const questionIndicator = document.getElementById('questionIndicator');
                const progressText = document.getElementById('progressText');
                
                if (questionIndicator) {
                    questionIndicator.textContent = `Question ${this.currentQuestion + 1}`;
                }
                
                if (progressText) {
                    progressText.textContent = `Question ${this.currentQuestion + 1} of ${this.questions.length}`;
                }
            }
            


            updateNavigationButtons() {
                // Main navigation buttons
                const prevBtn = document.getElementById('prevBtn');
                const nextBtn = document.getElementById('nextBtn');
                
                const currentResponse = this.responses[this.currentQuestion + 1];
                const hasResponse = currentResponse && (
                    typeof currentResponse === 'string' ? currentResponse.trim() : 
                    Array.isArray(currentResponse) ? currentResponse.length > 0 : true
                );
                
                // Update main navigation buttons
                if (prevBtn) {
                    prevBtn.style.display = this.currentQuestion > 0 ? 'flex' : 'none';
                }
                
                if (nextBtn) {
                    nextBtn.disabled = !hasResponse;
                    
                    if (this.currentQuestion >= this.questions.length - 1) {
                        nextBtn.innerHTML = '<i class="fas fa-check"></i> Complete Assessment';
                        nextBtn.onclick = () => this.completeAssessment();
                    } else {
                        nextBtn.innerHTML = 'Next <i class="fas fa-arrow-right"></i>';
                        nextBtn.onclick = () => this.nextQuestion();
                    }
                }
            }

            nextQuestion() {
                if (this.currentQuestion < this.questions.length - 1) {
                    this.currentQuestion++;
                    this.loadQuestion();
                    this.updateProgress();
                    this.updateNavigationButtons();
                    
                    // Smooth scroll to top
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }
            }

            previousQuestion() {
                if (this.currentQuestion > 0) {
                    this.currentQuestion--;
                    this.loadQuestion();
                    this.updateProgress();
                    this.updateNavigationButtons();
                    
                    // Smooth scroll to top
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }
            }

            async completeAssessment() {
                console.log('🏁 Completing assessment...');
                
                // Show loading state
                this.showLoadingState();
                
                try {
                    // Prepare assessment data
                    const basicInfo = {
                        name: this.responses[1] || 'Not provided',
                        age: this.responses[2] || 'Not provided',
                        gender: this.responses[3] || 'Not provided',
                        district: this.responses[4] || 'Not provided',
                        phone: this.responses[5] || 'Not provided'
                    };
                    
                    const specializedResponses = {};
                    for (let i = 6; i <= this.questions.length; i++) {
                        if (this.responses[i]) {
                            specializedResponses[`Q${i}`] = this.responses[i];
                        }
                    }
                    
                    const completionData = {
                        type: this.assessmentType,
                        basicInfo: basicInfo,
                        responses: specializedResponses,
                        allResponses: this.responses,
                        totalQuestions: this.questions.length,
                        completedAt: new Date().toISOString(),
                        duration: Date.now() - (this.startTime || Date.now())
                    };
                    
                    // Generate AI analysis using DeepSeek API
                    console.log('🤖 Generating AI analysis...');
                    const aiAnalysis = await this.generateAIAnalysis(completionData);
                    
                    // Generate comprehensive PDF report
                    console.log('📄 Generating PDF report...');
                    const pdfBlob = await this.generatePDFReport({
                        ...completionData,
                        aiAnalysis: aiAnalysis
                    });
                    
                    // Save to user's assessment history
                    await this.saveToUserHistory(completionData, aiAnalysis);
                    
                    // Show completion with download option
                    this.showCompletionMessage(pdfBlob, aiAnalysis);
                    
                } catch (error) {
                    console.error('Assessment completion error:', error);
                    this.showCompletionMessage(null, null, 'There was an issue generating your report. Please try again.');
                }
            }
            
            async generateAIAnalysis(assessmentData) {
                try {
                    // Create comprehensive prompt for DeepSeek API
                    const prompt = this.buildAnalysisPrompt(assessmentData);
                    
                    // Mock DeepSeek API call (replace with actual API endpoint)
                    const response = await fetch('/api/ai-analysis', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            prompt: prompt,
                            model: 'deepseek-chat',
                            max_tokens: 4000,
                            temperature: 0.3
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error('AI analysis request failed');
                    }
                    
                    const aiResponse = await response.json();
                    return this.parseAIResponse(aiResponse.choices[0].message.content);
                    
                } catch (error) {
                    console.error('AI analysis error:', error);
                    // Return fallback analysis
                    return this.getFallbackAnalysis(assessmentData);
                }
            }
            
            buildAnalysisPrompt(assessmentData) {
                const { type, basicInfo, responses } = assessmentData;
                
                let prompt = `You are a qualified healthcare AI assistant. Please provide a comprehensive health assessment analysis for a ${type.replace('-', ' ')} evaluation.

PATIENT INFORMATION:
- Name: ${basicInfo.name}
- Age: ${basicInfo.age}
- Gender: ${basicInfo.gender}
- Location: ${basicInfo.district}, Sri Lanka
- Contact: ${basicInfo.phone}

ASSESSMENT RESPONSES:
`;
                
                // Add all responses to prompt
                Object.entries(responses).forEach(([question, answer]) => {
                    prompt += `${question}: ${Array.isArray(answer) ? answer.join(', ') : answer}\n`;
                });
                
                prompt += `

Please provide a comprehensive analysis including:

1. ASSESSMENT SUMMARY: Brief overview of the patient's condition
2. KEY FINDINGS: Main health insights from responses
3. RISK FACTORS: Identified potential health risks
4. RECOMMENDATIONS: Specific, actionable health recommendations
5. NEXT STEPS: Suggested follow-up actions
6. LIFESTYLE ADVICE: Diet, exercise, and lifestyle modifications
7. WARNING SIGNS: When to seek immediate medical attention
8. PROGNOSIS: Expected outcomes with proper care

Make the analysis professional, empathetic, and actionable. Focus on evidence-based recommendations appropriate for the Sri Lankan healthcare context.`;

                return prompt;
            }
            
            parseAIResponse(aiContent) {
                // Parse the AI response into structured sections
                const sections = {};
                const lines = aiContent.split('\n');
                let currentSection = '';
                let currentContent = '';
                
                lines.forEach(line => {
                    if (line.match(/^\d+\.\s*[A-Z\s]+:/)) {
                        if (currentSection) {
                            sections[currentSection] = currentContent.trim();
                        }
                        currentSection = line.replace(/^\d+\.\s*/, '').replace(':', '').trim();
                        currentContent = '';
                    } else {
                        currentContent += line + '\n';
                    }
                });
                
                // Add last section
                if (currentSection) {
                    sections[currentSection] = currentContent.trim();
                }
                
                return {
                    summary: sections['ASSESSMENT SUMMARY'] || 'Assessment completed successfully.',
                    keyFindings: sections['KEY FINDINGS'] || 'Analysis in progress.',
                    riskFactors: sections['RISK FACTORS'] || 'No immediate risks identified.',
                    recommendations: sections['RECOMMENDATIONS'] || 'Follow standard health guidelines.',
                    nextSteps: sections['NEXT STEPS'] || 'Continue monitoring your health.',
                    lifestyleAdvice: sections['LIFESTYLE ADVICE'] || 'Maintain a healthy lifestyle.',
                    warningSigns: sections['WARNING SIGNS'] || 'Seek medical attention if symptoms worsen.',
                    prognosis: sections['PROGNOSIS'] || 'Good with proper care and follow-up.',
                    fullAnalysis: aiContent
                };
            }
            
            getFallbackAnalysis(assessmentData) {
                const { type } = assessmentData;
                
                return {
                    summary: `Thank you for completing your ${type.replace('-', ' ')} assessment. Your responses have been recorded and analyzed.`,
                    keyFindings: 'Your assessment has been completed successfully. A healthcare professional will review your responses.',
                    riskFactors: 'Based on your responses, we will provide personalized recommendations.',
                    recommendations: 'Follow up with a healthcare provider for personalized advice.',
                    nextSteps: 'Schedule a consultation with a healthcare professional if needed.',
                    lifestyleAdvice: 'Maintain a balanced diet, regular exercise, and adequate sleep.',
                    warningSign: 'Seek immediate medical attention if you experience severe or worsening symptoms.',
                    prognosis: 'With proper care and attention, your health outlook is positive.',
                    fullAnalysis: 'Comprehensive analysis will be available after professional review.'
                };
            }
            
            async generatePDFReport(data) {
                try {
                    // Use jsPDF to generate the report
                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF('p', 'mm', 'a4');
                    const pageWidth = doc.internal.pageSize.getWidth();
                    const pageHeight = doc.internal.pageSize.getHeight();
                    
                    // Define colors
                    const primaryColor = [102, 126, 234]; // #667eea
                    const secondaryColor = [16, 185, 129]; // #10b981
                    const textColor = [55, 65, 81]; // #374151
                    const lightGray = [249, 250, 251]; // #f9fafb
                    
                    // Helper function to add header to each page
                    const addHeader = () => {
                        // Header background
                        doc.setFillColor(...primaryColor);
                        doc.rect(0, 0, pageWidth, 25, 'F');
                        
                        // Logo area
                        doc.setFillColor(255, 255, 255);
                        doc.circle(15, 12.5, 8, 'F');
                        doc.setTextColor(102, 126, 234);
                        doc.setFontSize(12);
                        doc.setFont('helvetica', 'bold');
                        doc.text('🏥', 11, 16);
                        
                        // Title
                        doc.setTextColor(255, 255, 255);
                        doc.setFontSize(18);
                        doc.setFont('helvetica', 'bold');
                        doc.text('MediCare+ Health Assessment Report', 30, 12);
                        
                        doc.setFontSize(10);
                        doc.setFont('helvetica', 'normal');
                        doc.text('AI-Powered Healthcare Analysis Platform', 30, 18);
                        
                        // Date stamp
                        doc.setTextColor(255, 255, 255);
                        doc.setFontSize(8);
                        doc.text(`Generated: ${new Date().toLocaleDateString('en-US', { 
                            year: 'numeric', 
                            month: 'long', 
                            day: 'numeric',
                            hour: '2-digit',
                            minute: '2-digit'
                        })}`, pageWidth - 55, 16);
                    };
                    
                    // Helper function to add footer
                    const addFooter = (pageNum) => {
                        doc.setFillColor(...lightGray);
                        doc.rect(0, pageHeight - 20, pageWidth, 20, 'F');
                        
                        doc.setTextColor(107, 114, 128);
                        doc.setFontSize(8);
                        doc.text('This report is generated by MediCare+ AI Health Assistant using DeepSeek AI technology.', 20, pageHeight - 12);
                        doc.text('For informational purposes only. Consult healthcare professionals for medical advice.', 20, pageHeight - 8);
                        doc.text(`© 2024 MediCare+ | Colombo, Sri Lanka`, 20, pageHeight - 4);
                        
                        // Page number
                        doc.setTextColor(...primaryColor);
                        doc.setFont('helvetica', 'bold');
                        doc.text(`Page ${pageNum}`, pageWidth - 30, pageHeight - 8);
                    };
                    
                    // Page 1 - Cover and Patient Info
                    addHeader();
                    
                    let yPos = 40;
                    
                    // Assessment Type Badge
                    doc.setFillColor(...secondaryColor);
                    doc.roundedRect(20, yPos, 60, 12, 3, 3, 'F');
                    doc.setTextColor(255, 255, 255);
                    doc.setFontSize(10);
                    doc.setFont('helvetica', 'bold');
                    doc.text(data.type.replace('-', ' ').toUpperCase() + ' ASSESSMENT', 22, yPos + 8);
                    
                    yPos += 25;
                    
                    // Patient Information Section
                    doc.setFillColor(...lightGray);
                    doc.roundedRect(20, yPos, pageWidth - 40, 50, 5, 5, 'F');
                    
                    doc.setTextColor(...primaryColor);
                    doc.setFontSize(14);
                    doc.setFont('helvetica', 'bold');
                    doc.text('PATIENT INFORMATION', 25, yPos + 10);
                    
                    doc.setTextColor(...textColor);
                    doc.setFontSize(11);
                    doc.setFont('helvetica', 'normal');
                    
                    const patientInfo = [
                        ['Patient Name:', data.basicInfo.name || 'Not provided'],
                        ['Age:', data.basicInfo.age || 'Not provided'],
                        ['Gender:', data.basicInfo.gender || 'Not provided'],
                        ['District:', data.basicInfo.district || 'Not provided'],
                        ['Contact:', data.basicInfo.phone || 'Not provided'],
                        ['Assessment Date:', new Date(data.completedAt).toLocaleDateString('en-US', { 
                            weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' 
                        })]
                    ];
                    
                    let infoY = yPos + 20;
                    patientInfo.forEach((info, index) => {
                        if (index % 2 === 0) {
                            doc.setFont('helvetica', 'bold');
                            doc.text(info[0], 25, infoY);
                            doc.setFont('helvetica', 'normal');
                            doc.text(info[1], 60, infoY);
                        } else {
                            doc.setFont('helvetica', 'bold');
                            doc.text(info[0], 120, infoY - 6);
                            doc.setFont('helvetica', 'normal');
                            doc.text(info[1], 155, infoY - 6);
                            infoY += 8;
                        }
                    });
                    
                    yPos += 65;
                    
                    // Assessment Summary
                    doc.setTextColor(...primaryColor);
                    doc.setFontSize(16);
                    doc.setFont('helvetica', 'bold');
                    doc.text('EXECUTIVE SUMMARY', 20, yPos);
                    
                    yPos += 15;
                    doc.setTextColor(...textColor);
                    doc.setFontSize(11);
                    doc.setFont('helvetica', 'normal');
                    const summaryText = doc.splitTextToSize(data.aiAnalysis.summary, pageWidth - 40);
                    doc.text(summaryText, 20, yPos);
                    yPos += summaryText.length * 6 + 10;
                    
                    // Assessment Stats
                    doc.setFillColor(240, 253, 244);
                    doc.roundedRect(20, yPos, (pageWidth - 50) / 2, 25, 3, 3, 'F');
                    doc.setFillColor(239, 246, 255);
                    doc.roundedRect(30 + (pageWidth - 50) / 2, yPos, (pageWidth - 50) / 2, 25, 3, 3, 'F');
                    
                    // Questions analyzed
                    doc.setTextColor(5, 150, 105);
                    doc.setFontSize(20);
                    doc.setFont('helvetica', 'bold');
                    doc.text(data.questions ? data.questions.length.toString() : '30', 35, yPos + 12);
                    doc.setFontSize(10);
                    doc.text('Questions Analyzed', 35, yPos + 18);
                    
                    // AI confidence
                    doc.setTextColor(59, 130, 246);
                    doc.setFontSize(20);
                    doc.setFont('helvetica', 'bold');
                    doc.text('HIGH', 45 + (pageWidth - 50) / 2, yPos + 12);
                    doc.setFontSize(10);
                    doc.text('AI Confidence Level', 45 + (pageWidth - 50) / 2, yPos + 18);
                    
                    addFooter(1);
                    
                    // Page 2 - Detailed Analysis
                    doc.addPage();
                    addHeader();
                    yPos = 40;
                    
                    const analysisData = [
                        { 
                            title: 'KEY FINDINGS', 
                            content: data.aiAnalysis.keyFindings,
                            icon: '🔍',
                            color: [239, 68, 68]
                        },
                        { 
                            title: 'RISK FACTORS', 
                            content: data.aiAnalysis.riskFactors,
                            icon: '⚠️',
                            color: [245, 158, 11]
                        },
                        { 
                            title: 'RECOMMENDATIONS', 
                            content: data.aiAnalysis.recommendations,
                            icon: '💡',
                            color: [16, 185, 129]
                        },
                        { 
                            title: 'NEXT STEPS', 
                            content: data.aiAnalysis.nextSteps,
                            icon: '📋',
                            color: [99, 102, 241]
                        }
                    ];
                    
                    analysisData.forEach((section, index) => {
                        if (yPos > pageHeight - 80) {
                            doc.addPage();
                            addHeader();
                            yPos = 40;
                        }
                        
                        // Section header with icon
                        doc.setFillColor(...section.color.concat([20])); // Add transparency
                        doc.roundedRect(20, yPos - 5, pageWidth - 40, 15, 3, 3, 'F');
                        
                        doc.setTextColor(...section.color);
                        doc.setFontSize(14);
                        doc.setFont('helvetica', 'bold');
                        doc.text(`${section.icon} ${section.title}`, 25, yPos + 5);
                        
                        yPos += 20;
                        
                        // Section content
                        doc.setTextColor(...textColor);
                        doc.setFontSize(11);
                        doc.setFont('helvetica', 'normal');
                        const contentText = doc.splitTextToSize(section.content, pageWidth - 40);
                        doc.text(contentText, 20, yPos);
                        yPos += contentText.length * 6 + 15;
                    });
                    
                    // Lifestyle advice if available
                    if (data.aiAnalysis.lifestyleAdvice) {
                        if (yPos > pageHeight - 50) {
                            doc.addPage();
                            addHeader();
                            yPos = 40;
                        }
                        
                        doc.setFillColor(254, 243, 199);
                        doc.roundedRect(20, yPos - 5, pageWidth - 40, 15, 3, 3, 'F');
                        
                        doc.setTextColor(146, 64, 14);
                        doc.setFontSize(14);
                        doc.setFont('helvetica', 'bold');
                        doc.text('🌱 LIFESTYLE RECOMMENDATIONS', 25, yPos + 5);
                        
                        yPos += 20;
                        doc.setTextColor(...textColor);
                        doc.setFontSize(11);
                        doc.setFont('helvetica', 'normal');
                        const lifestyleText = doc.splitTextToSize(data.aiAnalysis.lifestyleAdvice, pageWidth - 40);
                        doc.text(lifestyleText, 20, yPos);
                        yPos += lifestyleText.length * 6 + 15;
                    }
                    
                    addFooter(2);
                    
                    // Page 3 - Warning Signs and Disclaimer
                    doc.addPage();
                    addHeader();
                    yPos = 40;
                    
                    // Warning signs
                    if (data.aiAnalysis.warningSigns) {
                        doc.setFillColor(254, 226, 226);
                        doc.roundedRect(20, yPos - 5, pageWidth - 40, 15, 3, 3, 'F');
                        
                        doc.setTextColor(220, 38, 38);
                        doc.setFontSize(14);
                        doc.setFont('helvetica', 'bold');
                        doc.text('🚨 WARNING SIGNS - SEEK IMMEDIATE MEDICAL ATTENTION', 25, yPos + 5);
                        
                        yPos += 20;
                        doc.setTextColor(...textColor);
                        doc.setFontSize(11);
                        doc.setFont('helvetica', 'normal');
                        const warningText = doc.splitTextToSize(data.aiAnalysis.warningSigns, pageWidth - 40);
                        doc.text(warningText, 20, yPos);
                        yPos += warningText.length * 6 + 20;
                    }
                    
                    // Emergency contact info
                    doc.setFillColor(220, 38, 38);
                    doc.roundedRect(20, yPos, pageWidth - 40, 25, 5, 5, 'F');
                    
                    doc.setTextColor(255, 255, 255);
                    doc.setFontSize(12);
                    doc.setFont('helvetica', 'bold');
                    doc.text('🚨 EMERGENCY CONTACTS - SRI LANKA', 25, yPos + 8);
                    doc.setFontSize(10);
                    doc.setFont('helvetica', 'normal');
                    doc.text('Emergency Services: 119 | Ambulance: 110 | Police: 118', 25, yPos + 15);
                    doc.text('National Hospital Colombo: +94 11 269 1111', 25, yPos + 20);
                    
                    yPos += 40;
                    
                    // Medical disclaimer
                    doc.setFillColor(...lightGray);
                    doc.roundedRect(20, yPos, pageWidth - 40, 60, 5, 5, 'F');
                    
                    doc.setTextColor(...primaryColor);
                    doc.setFontSize(14);
                    doc.setFont('helvetica', 'bold');
                    doc.text('IMPORTANT MEDICAL DISCLAIMER', 25, yPos + 10);
                    
                    doc.setTextColor(...textColor);
                    doc.setFontSize(10);
                    doc.setFont('helvetica', 'normal');
                    
                    const disclaimerText = [
                        '• This report is generated using DeepSeek AI technology for informational purposes only.',
                        '• It is NOT a substitute for professional medical diagnosis, treatment, or advice.',
                        '• Always consult qualified healthcare professionals for medical concerns.',
                        '• In case of emergency, contact emergency services immediately (119 in Sri Lanka).',
                        '• Use this report as supplementary information to discuss with your healthcare provider.',
                        '• MediCare+ and its AI system do not provide medical diagnoses or treatment recommendations.'
                    ];
                    
                    let disclaimerY = yPos + 20;
                    disclaimerText.forEach(line => {
                        doc.text(line, 25, disclaimerY);
                        disclaimerY += 6;
                    });
                    
                    // Signature section
                    yPos += 75;
                    doc.setTextColor(...textColor);
                    doc.setFontSize(10);
                    doc.setFont('helvetica', 'normal');
                    doc.text('Report generated by MediCare+ AI Health Assistant', 20, yPos);
                    doc.text(`Unique Report ID: MCR-${Date.now().toString().slice(-8)}`, 20, yPos + 6);
                    
                    addFooter(3);
                    
                    return doc.output('blob');
                    
                } catch (error) {
                    console.error('PDF generation error:', error);
                    return null;
                }
            }
            
            async saveToUserHistory(assessmentData, aiAnalysis) {
                try {
                    const historyItem = {
                        id: Date.now(),
                        type: assessmentData.type,
                        basicInfo: assessmentData.basicInfo,
                        completedAt: assessmentData.completedAt,
                        summary: aiAnalysis.summary,
                        recommendations: aiAnalysis.recommendations
                    };
                    
                    // Save to localStorage for now (replace with database call)
                    const existingHistory = JSON.parse(localStorage.getItem('assessment_history') || '[]');
                    existingHistory.unshift(historyItem);
                    localStorage.setItem('assessment_history', JSON.stringify(existingHistory.slice(0, 50))); // Keep last 50
                    
                    console.log('✅ Assessment saved to user history');
                } catch (error) {
                    console.error('Error saving to history:', error);
                }
            }
            
            showLoadingState() {
                const container = document.getElementById('questionContainer');
                container.innerHTML = `
                    <div style="text-align: center; padding: 3rem;">
                        <div class="loading-spinner" style="margin: 0 auto 2rem; width: 50px; height: 50px; border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                        <h2 style="color: #3498db; margin-bottom: 1rem;">Analyzing Your Assessment...</h2>
                        <p style="color: #666;">Our AI is generating your personalized health report. This may take a moment.</p>
                        <style>
                            @keyframes spin {
                                0% { transform: rotate(0deg); }
                                100% { transform: rotate(360deg); }
                            }
                        </style>
                    </div>
                `;
                
                // Hide navigation buttons
                document.getElementById('prevBtn').style.display = 'none';
                document.getElementById('nextBtn').style.display = 'none';
            }

            showCompletionMessage(pdfBlob, aiAnalysis, errorMessage = null) {
                const container = document.getElementById('questionContainer');
                
                if (errorMessage) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 3rem;">
                            <div style="font-size: 3rem; color: #ef4444; margin-bottom: 1rem;">⚠️</div>
                            <h2 style="color: #ef4444; margin-bottom: 1rem;">Assessment Incomplete</h2>
                            <p style="color: #666; margin-bottom: 2rem;">${errorMessage}</p>
                            <button class="btn btn-primary" onclick="window.location.reload()">Try Again</button>
                        </div>
                    `;
                } else {
                    // Create download URL for PDF
                    const pdfUrl = pdfBlob ? URL.createObjectURL(pdfBlob) : null;
                    const filename = `MediCare_Plus_Health_Report_${new Date().toISOString().split('T')[0]}.pdf`;
                    
                    container.innerHTML = `
                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 2rem 0;">
                            <div style="max-width: 1200px; margin: 0 auto; padding: 0 1rem;">
                                
                                <!-- Success Header -->
                                <div style="text-align: center; margin-bottom: 3rem;">
                                    <div style="background: white; border-radius: 50%; width: 120px; height: 120px; margin: 0 auto 2rem; display: flex; align-items: center; justify-content: center; box-shadow: 0 20px 40px rgba(0,0,0,0.1);">
                                        <i class="fas fa-check-circle" style="font-size: 4rem; color: #10b981;"></i>
                                    </div>
                                    <h1 style="color: white; font-size: 3rem; font-weight: 800; margin-bottom: 1rem; text-shadow: 0 2px 4px rgba(0,0,0,0.3);">Assessment Complete! 🎉</h1>
                                    <p style="color: rgba(255,255,255,0.9); font-size: 1.25rem; max-width: 600px; margin: 0 auto; line-height: 1.6;">
                                        Thank you for completing your <strong>${this.questions.length}-question</strong> health assessment. 
                                        Your personalized AI-powered report has been generated using advanced medical analysis.
                                    </p>
                                </div>

                                <!-- Results Grid -->
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 3rem;">
                                    
                                    <!-- AI Analysis Card -->
                                    ${aiAnalysis ? `
                                        <div style="background: white; border-radius: 20px; padding: 2.5rem; box-shadow: 0 20px 40px rgba(0,0,0,0.1); border: 1px solid rgba(255,255,255,0.2);">
                                            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 2rem;">
                                                <div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                                    <i class="fas fa-brain" style="font-size: 1.5rem;"></i>
                                                </div>
                                                <div>
                                                    <h3 style="color: #1e293b; margin: 0; font-size: 1.5rem; font-weight: 700;">AI Analysis Summary</h3>
                                                    <p style="color: #64748b; margin: 0; font-size: 0.9rem;">Generated using DeepSeek AI</p>
                                                </div>
                                            </div>
                                            
                                            <div style="background: #f8fafc; border-radius: 12px; padding: 1.5rem; margin-bottom: 1.5rem;">
                                                <h4 style="color: #1e40af; margin: 0 0 1rem 0; font-size: 1.1rem; font-weight: 600;">📋 Summary</h4>
                                                <p style="color: #374151; line-height: 1.6; margin: 0; font-size: 0.95rem;">${aiAnalysis.summary}</p>
                                            </div>
                                            
                                            <div style="background: #f0f9ff; border-radius: 12px; padding: 1.5rem; border: 1px solid #bfdbfe;">
                                                <h4 style="color: #1e40af; margin: 0 0 1rem 0; font-size: 1.1rem; font-weight: 600;">🎯 Key Recommendations</h4>
                                                <p style="color: #374151; line-height: 1.6; margin: 0; font-size: 0.95rem;">${aiAnalysis.recommendations}</p>
                                            </div>
                                        </div>
                                    ` : ''}
                                    
                                    <!-- Report Summary Card -->
                                    <div style="background: white; border-radius: 20px; padding: 2.5rem; box-shadow: 0 20px 40px rgba(0,0,0,0.1); border: 1px solid rgba(255,255,255,0.2);">
                                        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 2rem;">
                                            <div style="background: linear-gradient(135deg, #10b981, #059669); color: white; width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                                <i class="fas fa-file-medical" style="font-size: 1.5rem;"></i>
                                            </div>
                                            <div>
                                                <h3 style="color: #1e293b; margin: 0; font-size: 1.5rem; font-weight: 700;">Report Summary</h3>
                                                <p style="color: #64748b; margin: 0; font-size: 0.9rem;">Comprehensive health analysis</p>
                                            </div>
                                        </div>
                                        
                                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 2rem;">
                                            <div style="text-align: center; background: #f0fdf4; border-radius: 12px; padding: 1.5rem;">
                                                <div style="font-size: 2rem; font-weight: 800; color: #059669; margin-bottom: 0.5rem;">${this.questions.length}</div>
                                                <div style="color: #065f46; font-size: 0.9rem; font-weight: 600;">Questions Analyzed</div>
                                            </div>
                                            <div style="text-align: center; background: #eff6ff; border-radius: 12px; padding: 1.5rem;">
                                                <div style="font-size: 2rem; font-weight: 800; color: #2563eb; margin-bottom: 0.5rem;">${this.assessmentType.replace('-', ' ').toUpperCase()}</div>
                                                <div style="color: #1e40af; font-size: 0.9rem; font-weight: 600;">Assessment Type</div>
                                            </div>
                                        </div>
                                        
                                        <div style="background: #fef3c7; border-radius: 12px; padding: 1.5rem; border: 1px solid #f59e0b;">
                                            <h4 style="color: #92400e; margin: 0 0 0.75rem 0; font-size: 1rem; font-weight: 600;">
                                                <i class="fas fa-clock"></i> Generated: ${new Date().toLocaleDateString('en-US', { 
                                                    weekday: 'long', 
                                                    year: 'numeric', 
                                                    month: 'long', 
                                                    day: 'numeric',
                                                    hour: '2-digit',
                                                    minute: '2-digit'
                                                })}
                                            </h4>
                                            <p style="color: #92400e; margin: 0; font-size: 0.9rem; line-height: 1.5;">
                                                Your report includes detailed analysis, personalized recommendations, and actionable health insights.
                                            </p>
                                        </div>
                                    </div>
                                </div>

                                <!-- Action Buttons -->
                                <div style="text-align: center; margin-bottom: 3rem;">
                                    ${pdfBlob ? `
                                        <button onclick="window.downloadPDF('${pdfUrl}', '${filename}')" 
                                                style="background: linear-gradient(135deg, #10b981, #059669); color: white; border: none; padding: 18px 40px; border-radius: 50px; font-size: 1.1rem; font-weight: 700; cursor: pointer; margin: 0 1rem 1rem 0; box-shadow: 0 10px 25px rgba(16, 185, 129, 0.3); transition: all 0.3s ease; display: inline-flex; align-items: center; gap: 0.75rem;">
                                            <i class="fas fa-download" style="font-size: 1.2rem;"></i> 
                                            Download Professional Report (PDF)
                                        </button>
                                    ` : ''}
                                    <a href="user-dashboard.html" 
                                       style="background: linear-gradient(135deg, #6366f1, #8b5cf6); color: white; border: none; padding: 18px 40px; border-radius: 50px; font-size: 1.1rem; font-weight: 700; text-decoration: none; margin: 0 1rem 1rem 0; box-shadow: 0 10px 25px rgba(99, 102, 241, 0.3); transition: all 0.3s ease; display: inline-flex; align-items: center; gap: 0.75rem;">
                                        <i class="fas fa-home" style="font-size: 1.2rem;"></i> 
                                        Back to Dashboard
                                    </a>
                                    <a href="ai-health-assistant.html" 
                                       style="background: rgba(255,255,255,0.2); color: white; border: 2px solid rgba(255,255,255,0.3); padding: 18px 40px; border-radius: 50px; font-size: 1.1rem; font-weight: 700; text-decoration: none; margin: 0 1rem 1rem 0; backdrop-filter: blur(10px); transition: all 0.3s ease; display: inline-flex; align-items: center; gap: 0.75rem;">
                                        <i class="fas fa-plus" style="font-size: 1.2rem;"></i> 
                                        Take Another Assessment
                                    </a>
                                </div>

                                <!-- Medical Disclaimer -->
                                <div style="background: rgba(255,255,255,0.95); border-radius: 20px; padding: 2rem; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.3);">
                                    <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem;">
                                        <div style="background: #ef4444; color: white; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                            <i class="fas fa-exclamation-triangle" style="font-size: 1.2rem;"></i>
                                        </div>
                                        <h4 style="color: #dc2626; margin: 0; font-size: 1.3rem; font-weight: 700;">Important Medical Disclaimer</h4>
                                    </div>
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                                        <div>
                                            <p style="color: #374151; margin: 0 0 1rem 0; font-size: 0.95rem; line-height: 1.6;">
                                                <strong>🏥 AI Analysis Notice:</strong> This report is generated using DeepSeek AI technology for informational and educational purposes only. It is <strong>not a substitute</strong> for professional medical diagnosis, treatment, or advice.
                                            </p>
                                            <p style="color: #374151; margin: 0; font-size: 0.95rem; line-height: 1.6;">
                                                <strong>⚕️ Medical Consultation:</strong> Always consult with qualified healthcare professionals for medical concerns, diagnosis, and treatment decisions.
                                            </p>
                                        </div>
                                        <div>
                                            <p style="color: #374151; margin: 0 0 1rem 0; font-size: 0.95rem; line-height: 1.6;">
                                                <strong>🚨 Emergency:</strong> If experiencing a medical emergency, contact emergency services immediately (119 in Sri Lanka) or visit your nearest hospital.
                                            </p>
                                            <p style="color: #374151; margin: 0; font-size: 0.95rem; line-height: 1.6;">
                                                <strong>📋 Report Usage:</strong> Use this report as supplementary information to discuss with your healthcare provider.
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <style>
                            /* Button hover effects */
                            button, a {
                                transition: all 0.3s ease !important;
                            }
                            
                            button:hover, a:hover {
                                transform: translateY(-2px) !important;
                                box-shadow: 0 15px 35px rgba(0,0,0,0.2) !important;
                            }
                            
                            @media (max-width: 768px) {
                                div[style*="grid-template-columns: 1fr 1fr"] {
                                    grid-template-columns: 1fr !important;
                                }
                                button, a {
                                    display: block !important;
                                    width: 100% !important;
                                    margin: 0 0 1rem 0 !important;
                                    text-align: center !important;
                                }
                            }
                        </style>
                    `;
                }
                
                // Hide navigation buttons and sidebar
                document.getElementById('prevBtn').style.display = 'none';
                document.getElementById('nextBtn').style.display = 'none';
                document.getElementById('progressSidebar').style.display = 'none';
                
                // Update main content container for full width
                document.querySelector('.container').style.gridTemplateColumns = '1fr';
            }
        }

        // Global functions for navigation
        function nextQuestion() {
            if (window.assessment) {
                window.assessment.nextQuestion();
            }
        }

        function previousQuestion() {
            if (window.assessment) {
                window.assessment.previousQuestion();
            }
        }
        
        // Global function for PDF download
        window.downloadPDF = function(pdfUrl, filename) {
            const link = document.createElement('a');
            link.href = pdfUrl;
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            // Show success message
            const notification = document.createElement('div');
            notification.innerHTML = `
                <div style="position: fixed; top: 20px; right: 20px; background: #10b981; color: white; padding: 1rem 1.5rem; border-radius: 8px; z-index: 1000; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                    <i class="fas fa-check-circle"></i> Report downloaded successfully!
                </div>
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                document.body.removeChild(notification);
            }, 3000);
        };

        // Initialize assessment when page loads
        document.addEventListener('DOMContentLoaded', function() {
            window.assessment = new EnhancedAIHealthSystem();
        });
    </script>
</body>
</html> 
